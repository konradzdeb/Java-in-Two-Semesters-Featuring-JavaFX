<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
	"http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd">
<html>
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="generator" content="ABBYY FineReader PDF 15">
<style type="text/css">
 table.main {}
 tr.row {}
 td.cell {}
 div.block {}
 div.paragraph {}
 .font0 { font:8pt Arial, sans-serif; }
 .font1 { font:10pt Arial, sans-serif; }
 .font2 { font:12pt Arial, sans-serif; }
 .font3 { font:10pt Segoe UI, sans-serif; }
 .font4 { font:7pt SimHei, sans-serif; }
 .font5 { font:10pt SimHei, sans-serif; }
 .font6 { font:12pt SimHei, sans-serif; }
 .font7 { font:8pt SimSun, serif; }
 .font8 { font:9pt SimSun, serif; }
 .font9 { font:10pt SimSun, serif; }
 .font10 { font:10pt Times New Roman, serif; }

</style>
</head>
<body>
<p><span class="font10">10.4 </span><span class="font9">存储数据</span></p>
<p><span class="font10">183</span></p>
<ul style="list-style:none;"><li>
<p><span class="font0"># </span><span class="font7">否则，就提示用户输入用户名并存储它 </span><span class="font0">filename = 'username.json' try:</span></p></li></ul>
<p><span class="font4">❶ </span><span class="font0">with open(filename) as f_obj:</span></p>
<p><span class="font4">❷ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="font0">username = json.load(f_obj)</span></p>
<p><span class="font4">❸ </span><span class="font0">except FileNotFoundError:</span></p>
<p><span class="font4">❹ </span><span class="font0">username = input(&quot;What is your name?&quot;)</span></p>
<p><span class="font4">❺ </span><span class="font0">with open(filename, 'w') as f_obj: json.dump(username, f_obj) print(&quot;We'll remember you when you come back, &quot;&nbsp;+ username + &quot;!&quot;) else:</span></p>
<p><span class="font0">print(&quot;Welcome back, &quot;&nbsp;+ username + &quot;!&quot;)</span></p>
<p><span class="font9">这里没有任何新代码，只是将前两个示例的代码合并到了一个程序中。在。处，我们尝试打 开文件</span><span class="font10">usernamejson</span><span class="font9">。如果这个文件存在，就将其中的用户名读取到内存中(见</span><span class="font5">❷</span><span class="font9">)，再执行</span><span class="font3">else </span><span class="font9">代码块，即打印一条欢迎用户回来的消息。用户首次运行这个程序时，文件</span><span class="font10">username.json</span><span class="font9">不存在， 将引发</span><span class="font3">FileNotFoundError</span><span class="font9">异常(见</span><span class="font5">❸</span><span class="font9">)，因此</span><span class="font10">Python</span><span class="font9">将执行</span><span class="font3">except</span><span class="font9">代码块：提示用户输入其用户名 (见</span><span class="font5">❹</span><span class="font9">)，再使用</span><span class="font3">json.dump()</span><span class="font9">存储该用户名，并打印一句问候语(见</span><span class="font5">❺</span><span class="font9">)。</span></p>
<p><span class="font9">无论执行的是</span><span class="font3">except</span><span class="font9">代码块还是</span><span class="font3">else</span><span class="font9">代码块，都将显示用户名和合适的问候语。如果这个程 序是首次运行，输出将如下：</span></p>
<p><span class="font0">What is your name? </span><span class="font0" style="font-weight:bold;">Eric</span></p>
<div>
<p><span class="font2" style="font-weight:bold;">10</span></p>
</div><br clear="all">
<p><span class="font0">We'll remember you when you come back, Eric!</span></p>
<p><span class="font9">否则，输出将如下：</span></p>
<p><span class="font0">Welcome back, Eric!</span></p>
<p><span class="font9">这是程序之前至少运行了一次时的输出。</span></p>
<ul style="list-style:none;"><li><a name="caption1"></a>
<h5><a name="bookmark0"></a><span class="font2"><a name="bookmark1"></a>10.4.3 </span><span class="font6">重构</span></h5></li></ul>
<p><span class="font9">你经常会遇到这样的情况：代码能够正确地运行，但可做进一步的改进</span><span class="font10">——</span><span class="font9">将代码划分为 一系列完成具体工作的函数。这样的过程被称为</span><span class="font8">重构</span><span class="font9">。重构让代码更清晰、更易于理解、更容 易扩展。</span></p>
<p><span class="font9">要重构</span><span class="font10">remember_me.py</span><span class="font9">，可将其大部分逻辑放到一个或多个函数中。</span><span class="font10">remember_me.py</span><span class="font9">的重点 是问候用户，因此我们将其所有代码都放到一个名为</span><span class="font3">greet_user()</span><span class="font9">的函数中：</span></p>
<p><span class="font1">remember_me.py</span></p>
<p><span class="font0">import json</span></p>
<p><span class="font0">def greet_user():</span></p>
<p><span class="font4">❶ &nbsp;&nbsp;</span><span class="font0">&quot;&quot;&quot;</span><span class="font7">问候用户，并指出其名字</span><span class="font0">&quot;&quot;&quot;</span></p>
<p><span class="font0">filename = 'username.json'</span></p>
<p><span class="font0">try:</span></p>
<div>
</div><br clear="all">
<div>
</div><br clear="all">
<div>
</div><br clear="all">
<div>
</div><br clear="all">
<div>
</div><br clear="all">
<div>
</div><br clear="all">
</body>
</html>