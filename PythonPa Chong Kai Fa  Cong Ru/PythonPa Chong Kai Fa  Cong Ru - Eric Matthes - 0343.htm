<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
	"http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd">
<html>
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="generator" content="ABBYY FineReader PDF 15">
<style type="text/css">
 table.main {}
 tr.row {}
 td.cell {}
 div.block {}
 div.paragraph {}
 .font0 { font:8pt Arial, sans-serif; }
 .font1 { font:10pt Arial, sans-serif; }
 .font2 { font:12pt Arial, sans-serif; }
 .font3 { font:10pt Segoe UI, sans-serif; }
 .font4 { font:7pt SimHei, sans-serif; }
 .font5 { font:10pt SimHei, sans-serif; }
 .font6 { font:12pt SimHei, sans-serif; }
 .font7 { font:10pt SimSun, serif; }
 .font8 { font:10pt Times New Roman, serif; }

</style>
</head>
<body>
<p><span class="font8">326 </span><span class="font7">第</span><span class="font8">16</span><span class="font7">章下载数据</span></p>
<p><span class="font7">为</span><span class="font8">Pygal</span><span class="font7">能够处理的格式。</span></p>
<ul style="list-style:none;"><li>
<p><span class="font2">16.2.3</span><span class="font6"> 将字符串转换为数字值</span></p></li></ul>
<p><span class="font8">population_datajson</span><span class="font7">中的每个键和值都是字符串。为处理这些人口数据，我们需要将表示人 口数量的字符串转换为数字值，为此我们使用函数</span><span class="font3">int()</span><span class="font7">:</span></p><a name="caption1"></a>
<h6><a name="bookmark0"></a><span class="font1"><a name="bookmark1"></a>world_population.py</span></h6>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font0">for pop_dict in pop_data:</span></p>
<p><span class="font0">if pop_dict['Year'] == '2010':</span></p>
<p><span class="font0">country_name = pop_dict['Country Name']</span></p>
<p><span class="font4">❶ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="font0">population = int(pop_dict['Value'])</span></p>
<p><span class="font4">❷ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="font0">print(country_name + &quot;: &quot;&nbsp;+ str(population))</span></p>
<p><span class="font7">在</span><span class="font5">❶</span><span class="font7">处，我们将每个人口数量值都存储为数字格式。打印人口数量值时，需要将其转换为字 符串(见</span><span class="font5">❷</span><span class="font7">)。</span></p>
<p><span class="font7">然而，对于有些值，这种转换会导致错误，如下所示：</span></p>
<p><span class="font0">Arab World: 357868000</span></p>
<p><span class="font0">Caribbean small states: 6880000</span></p>
<p><span class="font0">East Asia &amp;&nbsp;Pacific (all income levels): 2201536674</span></p>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font0">Traceback (most recent call last):</span></p>
<p><span class="font0">File &quot;print_populations.py&quot;, line 12, in &lt;module&gt;</span></p>
<p><span class="font0">population = int(pop_dict['Value'])</span></p>
<p><span class="font4">❶ </span><span class="font0">ValueError: invalid literal for int() with base 10: '1127437398.85751'</span></p>
<p><span class="font7">原始数据的格式常常不统一，因此经常会出现错误。导致上述错误的原因是，</span><span class="font8">Python</span><span class="font7">不能直 接将包含小数点的字符串</span><span class="font3">'1127437398.85751'</span><span class="font7">转换为整数(这个小数值可能是人口数据缺失时通 过插值得到的)。为消除这种错误，我们先将字符串转换为浮点数，再将浮点数转换为整数：</span></p>
<h6><a name="bookmark2"></a><span class="font1"><a name="bookmark3"></a>world_population.py</span></h6>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font0">for pop_dict in pop_data:</span></p>
<p><span class="font0">if pop_dict['Year'] == '2010':</span></p>
<p><span class="font0">country = pop_dict['Country Name']</span></p>
<p><span class="font0">population = int(float(pop_dict['Value']))</span></p>
<p><span class="font0">print(country + &quot;: &quot;&nbsp;+ str(population))</span></p>
<h6><a name="bookmark4"></a><span class="font7"><a name="bookmark5"></a>函数</span><span class="font3">float()</span><span class="font7">将字符串转换为小数，而函数</span><span class="font3">int()</span><span class="font7">丢弃小数部分，返回一个整数。现在，我们 可以打印</span><span class="font8">2010</span><span class="font7">年的完整人口数据，不会导致错误了：</span></h6>
<p><span class="font0">Arab World: 357868000</span></p>
<p><span class="font0">Caribbean small states: 6880000</span></p>
<p><span class="font0">East Asia &amp;&nbsp;Pacific (all income levels): 2201536674</span></p>
<div>
</div><br clear="all">
<div>
</div><br clear="all">
</body>
</html>