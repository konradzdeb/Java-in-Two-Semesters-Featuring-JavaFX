<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
	"http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd">
<html>
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="generator" content="ABBYY FineReader PDF 15">
<style type="text/css">
 table.main {}
 tr.row {}
 td.cell {}
 div.block {}
 div.paragraph {}
 .font0 { font:8pt Arial, sans-serif; }
 .font1 { font:10pt Arial, sans-serif; }
 .font2 { font:12pt Arial, sans-serif; }
 .font3 { font:10pt Segoe UI, sans-serif; }
 .font4 { font:10pt SimHei, sans-serif; }
 .font5 { font:12pt SimHei, sans-serif; }
 .font6 { font:10pt SimSun, serif; }
 .font7 { font:10pt Times New Roman, serif; }

</style>
</head>
<body>
<p><span class="font7">402</span></p>
<p><span class="font6">第</span><span class="font7">19</span><span class="font6">章 用户账户</span></p>
<p><span class="font6">在项目“学习笔记”中，我们将不限制对主页、注册页面和注销页面的访问，并限制对其他 所有页面的访问。</span></p>
<p><span class="font6">在下面的</span><span class="font7">learning_logs/views.py</span><span class="font6">中，对除</span><span class="font3">index</span><span class="font6">。外的每个视图都应用了装饰器 </span><span class="font3">@login_required</span><span class="font6">：</span></p>
<p><span class="font1">views.py</span></p>
<p><span class="font0">--</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p>
<p><span class="font0">@login_required</span></p>
<p><span class="font0">def topics(request):</span></p>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font0">@login_required</span></p>
<p><span class="font0">def topic(request, topic_id):</span></p>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font0">@login_required</span></p>
<p><span class="font0">def new_topic(request):</span></p>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font0">@login_required</span></p>
<p><span class="font0">def new_entry(request, topic_id):</span></p>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font0">@login_required</span></p>
<p><span class="font0">def edit_entry(request, entry_id):</span></p>
<ul style="list-style:none;"><li>
<p><span class="font0">- -</span><span class="font0" style="font-style:italic;">snip</span><span class="font0">--</span></p></li></ul>
<p><span class="font6">如果你在未登录的情况下尝试访问这些页面，将被重定向到登录页面。另外，你还不能单击 到</span><span class="font3">new_topic</span><span class="font6">等页面的链接。但如果你输入</span><span class="font7">URL </span><a href="http://localhost:8000/new_topic/,%e5%b0%86%e9%87%8d%e5%ae%9a%e5%90%91%e5%88%b0%e7%99%bb%e5%bd%95"><span class="font7">http://localhost:8000/new_topic/</span><span class="font6">,将重定向到登录</span></a><span class="font6"> 页面「对于所有与私有用户数据相关的</span><span class="font7">URL</span><span class="font6">,都应限制对它们的访问。</span></p>
<ul style="list-style:none;"><li>
<p><span class="font2">19.3.2 </span><span class="font5">将数据关联到用户</span></p></li></ul>
<p><span class="font6">现在,需要将数据关联到提交它们的用户。我们只需将最高层的数据关联到用户,这样更低 层的数据将自动关联到用户。例如,在项目“学习笔记”中,应用程序的最高层数据是主题,而 所有条目都与特定主题相关联。只要每个主题都归属于特定用户,我们就能确定数据库中每个条 目的所有者。</span></p>
<p><span class="font6">下面来修改模型</span><span class="font3">Topic</span><span class="font6">，在其中添加一个关联到用户的外键。这样做后，我们必须对数据库 进行迁移。最后,我们必须对有些视图进行修改,使其只显示与当前登录的用户相关联的数据。</span></p>
<ul style="list-style:none;"><li>
<p><span class="font1">1.</span><span class="font4"> 修改模型</span><span class="font1">Topic</span></p></li></ul>
<p><span class="font6">对</span><span class="font7">models.py</span><span class="font6">的修改只涉及两行代码：</span></p>
<p><span class="font1">models.py</span></p>
<p><span class="font0">from django.db import models</span></p>
<p><span class="font0">from django.contrib.auth.models import User</span></p>
</body>
</html>